<script>
    const trainInputTableObject = new TableObject();
    const trainOutputTableObject = new TableObject();
    const testInputTableObject = new TableObject();
    const testOutputTableObject = new TableObject();

    function setTrainInput() {
        const arrArr = trainInputTableObject.getEncodedData();
        network.setTrainInput(toVecVecNum(arrArr));
    }

    function setTrainOutput() {
        const arrArr = trainOutputTableObject.getEncodedData();
        network.setTrainOutput(toVecVecNum(arrArr));
    }

    function setTestInput() {
        const arrArr = testInputTableObject.getEncodedData();
        network.setTestInput(toVecVecNum(arrArr));
    }

    function setTestOutput() {
        const arrArr = testOutputTableObject.getEncodedData();
        network.setTestOutput(toVecVecNum(arrArr));
    }
</script>
<div class="row">
    <div class="col">
        <div class="btn-group mt-2" role="group">
            <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false">Use Dataset
            </button>
            <ul class="dropdown-menu">
                <li>
                    <button class="dropdown-item" onclick="handleLoadDataset('xor')">
                        XOR Dataset
                    </button>
                    <button class="dropdown-item" onclick="handleLoadDataset('fruits')">
                        Fruits Color & Sweetness Dataset
                    </button>
                    <button class="dropdown-item" onclick="handleLoadDataset('mobile')">
                        Mobile Prices Dataset
                    </button>
                </li>
            </ul>
        </div>
        <script>
            async function handleLoadDataset(dataset) {
                const read = async (set, name) =>
                    readTextFilePath("datasets/" + set + "/" + name + ".csv").then(csvToArrArr);
                trainInputTableObject.setDataAndHeaders(await read(dataset, "train_in"), "Input");
                trainOutputTableObject.setDataAndHeaders(await read(dataset, "train_out"), "Output");
                testInputTableObject.setDataAndHeaders(await read(dataset, "test_in"), "Input");
                testOutputTableObject.setDataAndHeaders(await read(dataset, "test_out"), "Output");
                setTrainInput();
                setTrainOutput();
                setTestInput();
                setTestOutput();
            }
        </script>
    </div>
    <div class="col">
        <div class="px-2">
            <p>Data is always one-hot encoded if categorical columns are found.</p>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="dataEncodeDataCheck"
                       checked onchange="handleDataOptionsChange()">
                <label class="form-check-label" for="dataEncodeDataCheck">Show Encoded Data</label>
            </div>
        </div>
        <script>
            function handleDataOptionsChange() {
                previewTrainTable();
                previewTestTable();
            }
        </script>
    </div>
</div>
<hr>
<div class="row">
    <script>
        function activateFileInputButton(btn, name, size) {
            btn.innerHTML = name + "<br>" + "Valid Rows: " + size;
            btn.classList.add('active');
        }

        function deactivateFileInputButton(btn, name) {
            btn.innerHTML = name;
            btn.classList.remove('active');
        }
    </script>
    <div class="col">
        <h5>Training Data</h5>
        <input type="file" id="trainInputFileInput" accept=".csv" style="display: none"
               onchange="handleTrainInputUpload(this)">
        <div class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-light" id="trainInputFileButton"
                    onclick="document.getElementById('trainInputFileInput').click()">Browse Input File
            </button>
            <button type="button" class="btn btn-light" id="trainInputClearButton"
                    disabled onclick="handleTrainInputClear()">Clear
            </button>
            <button type="button" class="btn btn-light" id="trainInputDownloadButton"
                    disabled onclick="handleTrainInputDownload()">Download
            </button>
        </div>
        <script>
            async function handleTrainInputUpload(fileInput) {
                const data = await handleTextFileUpload(fileInput).then(csvToArrArr);
                trainInputTableObject.setDataAndHeaders(data, "Input");
                setTrainInput();
            }

            function onTrainInputSet() {
                const btn = document.getElementById('trainInputFileButton');
                activateFileInputButton(btn, "Train Input Loaded", trainInputTableObject.data.length);
                document.getElementById('trainInputClearButton').disabled = false;
                document.getElementById('trainInputDownloadButton').disabled = false;
                setInputHeight(trainInputTableObject.getEncodedData()[0].length);
                previewTrainTable();
            }

            function handleTrainInputClear() {
                network.clearTrainInput();
            }

            function onTrainInputCleared() {
                trainInputTableObject.clear();
                const btn = document.getElementById('trainInputFileButton');
                deactivateFileInputButton(btn, "Browse Input File");
                document.getElementById('trainInputClearButton').disabled = true;
                document.getElementById('trainInputDownloadButton').disabled = true;
                previewTrainTable();
            }

            function handleTrainInputDownload() {
                const arrArr = trainInputTableObject.data;
                const csvString = arrArrToCsv(arrArr);
                downloadCSV(csvString, "train_input.csv");
            }
        </script>
        <input type="file" id="trainOutputFileInput" accept=".csv" style="display: none"
               onchange="handleTrainOutputUpload(this)">
        <div class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-light" id="trainOutputFileButton"
                    onclick="document.getElementById('trainOutputFileInput').click()">Browse Output File
            </button>
            <button type="button" class="btn btn-light" id="trainOutputClearButton"
                    disabled onclick="handleTrainOutputClear()">Clear
            </button>
            <button type="button" class="btn btn-light" id="trainOutputDownloadButton"
                    disabled onclick="handleTrainOutputDownload()">Download
            </button>
        </div>
        <script>
            async function handleTrainOutputUpload(fileInput) {
                const data = await handleTextFileUpload(fileInput).then(csvToArrArr);
                trainOutputTableObject.setDataAndHeaders(data, "Output");
                setTrainOutput();
            }

            function onTrainOutputSet() {
                const btn = document.getElementById('trainOutputFileButton');
                activateFileInputButton(btn, "Train Output Loaded", trainOutputTableObject.data.length);
                document.getElementById('trainOutputClearButton').disabled = false;
                document.getElementById('trainOutputDownloadButton').disabled = false;
                setOutputHeight(trainOutputTableObject.getEncodedData()[0].length);
                previewTrainTable();
            }

            function handleTrainOutputClear() {
                network.clearTrainOutput();
            }

            function onTrainOutputCleared() {
                trainOutputTableObject.clear();
                const btn = document.getElementById('trainOutputFileButton');
                deactivateFileInputButton(btn, "Browse Output File");
                document.getElementById('trainOutputClearButton').disabled = true;
                document.getElementById('trainOutputDownloadButton').disabled = true;
                previewTrainTable();
            }

            function handleTrainOutputDownload() {
                const arrArr = trainOutputTableObject.data;
                const csvString = arrArrToCsv(arrArr);
                downloadCSV(csvString, "train_output.csv");
            }
        </script>
        <div class="row justify-content-center mt-3">
            <div class="col table-responsive">
                <table class="table table-bordered">
                    <thead id="trainPreviewThead"></thead>
                    <tbody id="trainPreviewTbody"></tbody>
                </table>
            </div>
        </div>
        <script>
            function previewTrainTable() {
                document.getElementById('trainPreviewThead').innerHTML = '';
                document.getElementById('trainPreviewTbody').innerHTML = '';
                const encoded = document.getElementById('dataEncodeDataCheck').checked;

                const input = trainInputTableObject.getPreviewData(encoded);
                const h1 = appendTableHeaders("#trainPreviewThead", input.headers);
                const b1 = appendTableCells("#trainPreviewTbody", input.data);
                styleTableSelection(h1, b1, 'table-default');

                const output = trainOutputTableObject.getPreviewData(encoded);
                const h2 = appendTableHeaders("#trainPreviewThead", output.headers);
                const b2 = appendTableCells("#trainPreviewTbody", output.data);
                styleTableSelection(h2, b2, 'table-secondary');
            }
        </script>
    </div>
    <div class="col">
        <h5>Testing Data</h5>
        <input type="file" id="testInputFileInput" accept=".csv" style="display: none"
               onchange="handleTestInputUpload(this)">
        <div class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-light" id="testInputFileButton"
                    onclick="document.getElementById('testInputFileInput').click()">Browse Input File
            </button>
            <button type="button" class="btn btn-light" id="testInputClearButton"
                    disabled onclick="handleTestInputClear()">Clear
            </button>
            <button type="button" class="btn btn-light" id="testInputDownloadButton"
                    disabled onclick="handleTestInputDownload()">Download
            </button>
        </div>
        <script>
            async function handleTestInputUpload(fileInput) {
                const data = await handleTextFileUpload(fileInput).then(csvToArrArr);
                testInputTableObject.setDataAndHeaders(data, "Input");
                setTestInput();
            }

            function onTestInputSet() {
                const btn = document.getElementById('testInputFileButton');
                activateFileInputButton(btn, "Test Input Loaded", testInputTableObject.data.length);
                document.getElementById('testInputClearButton').disabled = false;
                document.getElementById('testInputDownloadButton').disabled = false;
                previewTestTable();
            }

            function handleTestInputClear() {
                network.clearTestInput();
            }

            function onTestInputCleared() {
                testInputTableObject.clear();
                const btn = document.getElementById('testInputFileButton');
                deactivateFileInputButton(btn, "Browse Input File");
                document.getElementById('testInputClearButton').disabled = true;
                document.getElementById('testInputDownloadButton').disabled = true;
                previewTestTable();
            }

            function handleTestInputDownload() {
                const arrArr = testInputTableObject.data;
                const csvString = arrArrToCsv(arrArr);
                downloadCSV(csvString, "test_input.csv");
            }
        </script>
        <input type="file" id="testOutputFileInput" accept=".csv" style="display: none"
               onchange="handleTestOutputUpload(this)">
        <div class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-light" id="testOutputFileButton"
                    onclick="document.getElementById('testOutputFileInput').click()">Browse Output File
            </button>
            <button type="button" class="btn btn-light" id="testOutputClearButton"
                    disabled onclick="handleTestOutputClear()">Clear
            </button>
            <button type="button" class="btn btn-light" id="testOutputDownloadButton"
                    disabled onclick="handleTestOutputDownload()">Download
            </button>
        </div>
        <script>
            async function handleTestOutputUpload(fileInput) {
                const data = await handleTextFileUpload(fileInput).then(csvToArrArr);
                testOutputTableObject.setDataAndHeaders(data, "Output");
                setTestOutput();
            }

            function onTestOutputSet() {
                const btn = document.getElementById('testOutputFileButton');
                activateFileInputButton(btn, "Test Output Loaded", testOutputTableObject.data.length);
                document.getElementById('testOutputClearButton').disabled = false;
                document.getElementById('testOutputDownloadButton').disabled = false;
                previewTestTable();
            }

            function handleTestOutputClear() {
                network.clearTestOutput();
            }

            function onTestOutputCleared() {
                testOutputTableObject.clear();
                const btn = document.getElementById('testOutputFileButton');
                deactivateFileInputButton(btn, "Browse Output File");
                document.getElementById('testOutputClearButton').disabled = true;
                document.getElementById('testOutputDownloadButton').disabled = true;
                previewTestTable();
            }

            function handleTestOutputDownload() {
                const arrArr = testOutputTableObject.data;
                const csvString = arrArrToCsv(arrArr);
                downloadCSV(csvString, "test_output.csv");
            }
        </script>
        <div class="row justify-content-center mt-3">
            <div class="col table-responsive">
                <table class="table table-bordered">
                    <thead id="testPreviewThead"></thead>
                    <tbody id="testPreviewTbody"></tbody>
                </table>
            </div>
        </div>
        <script>
            function previewTestTable() {
                document.getElementById('testPreviewThead').innerHTML = '';
                document.getElementById('testPreviewTbody').innerHTML = '';
                const encoded = document.getElementById('dataEncodeDataCheck').checked;

                const input = testInputTableObject.getPreviewData(encoded);
                const h1 = appendTableHeaders("#testPreviewThead", input.headers);
                const b1 = appendTableCells("#testPreviewTbody", input.data);
                styleTableSelection(h1, b1, 'table-default');

                const output = testOutputTableObject.getPreviewData(encoded);
                const h2 = appendTableHeaders("#testPreviewThead", output.headers);
                const b2 = appendTableCells("#testPreviewTbody", output.data);
                styleTableSelection(h2, b2, 'table-secondary');
            }
        </script>
    </div>
</div>