<div class="row">
    <div class="col">
        <h5>Training Data</h5>
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-light" id="inputTrainingDataButton"
                    onclick="network.promptInputTrainingData()">Browse Input File
            </button>
            <button type="button" class="btn btn-light" id="outputTrainingDataButton"
                    onclick="network.promptOutputTrainingData()">Browse Output File
            </button>
        </div>
        <div class="btn-group mt-2" role="group">
            <div class="btn-group">
                <button type="button" class="btn btn-primary" id="prepareTrainingDataButton"
                        onclick="network.prepareTrainingData()">Load
                </button>
                <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown" aria-expanded="false">
                    <span class="visually-hidden">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <button class="dropdown-item" onclick="loadTrainDataset('xor')">
                            XOR Dataset
                        </button>
                        <button class="dropdown-item" onclick="loadTrainDataset('mobile')">
                            Mobile Prices Dataset
                        </button>
                    </li>
                </ul>
            </div>
            <button type="button" class="btn btn-outline-primary bi bi-download" id="downloadTrainFilesButton" disabled
                    onclick="network.downloadTrainIn(); network.downloadTrainOut()">Download
            </button>
            <button type="button" class="btn btn-danger" id="clearTrainingDataButton" onclick="onClearTrainingData()">
                Clear
            </button>
        </div>
        <div class="row justify-content-center mt-3">
            <div class="col table-responsive">
                <table class="table table-bordered">
                    <thead id="trainPreviewThead"></thead>
                    <tbody id="trainPreviewTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col">
        <h5>Testing Data</h5>
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-light" id="inputTestingDataButton"
                    onclick="network.promptInputTestingData()">Browse Input File
            </button>
            <button type="button" class="btn btn-light" id="outputTestingDataButton"
                    onclick="network.promptOutputTestingData()">Browse Output File
            </button>
        </div>
        <div class="btn-group mt-2" role="group">
            <div class="btn-group">
                <button type="button" class="btn btn-primary" id="prepareTestingDataButton"
                        onclick="network.prepareTestingData()">Load
                </button>
                <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown" aria-expanded="false">
                    <span class="visually-hidden">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <button class="dropdown-item" onclick="loadTestDataset('xor')">
                            XOR Dataset
                        </button>
                        <button class="dropdown-item" onclick="loadTestDataset('mobile')">
                            Mobile Prices Dataset
                        </button>
                    </li>
                </ul>
            </div>
            <button type="button" class="btn btn-outline-primary bi bi-download" id="downloadTestFilesButton" disabled
                    onclick="network.downloadTestIn(); network.downloadTestOut()">Download
            </button>
            <button type="button" class="btn btn-danger" id="clearTestingDataButton" onclick="onClearTestingData()">
                Clear
            </button>
        </div>
        <div class="row justify-content-center mt-3">
            <div class="col table-responsive">
                <table class="table table-bordered">
                    <thead id="testPreviewThead"></thead>
                    <tbody id="testPreviewTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    function onDataFileSet(element, filename, dataSize) {
        element.setAttribute('data-size', dataSize);
        element.innerHTML = filename + "<br>" + "Valid Rows: " + Number(dataSize);
        element.classList.add('active');
    }

    function onInputTrainingFileSet(filename, dataSize) {
        onDataFileSet(document.getElementById('inputTrainingDataButton'), filename, dataSize);
    }

    function onOutputTrainingFileSet(filename, dataSize) {
        onDataFileSet(document.getElementById('outputTrainingDataButton'), filename, dataSize);
    }

    function onInputTestingFileSet(filename, dataSize) {
        onDataFileSet(document.getElementById('inputTestingDataButton'), filename, dataSize);
    }

    function onOutputTestingFileSet(filename, dataSize) {
        onDataFileSet(document.getElementById('outputTestingDataButton'), filename, dataSize);
    }

    function onTrainingDataPrepared(dataSize) {
        const previewSize = onPreviewTrainingData();
        const html =
            "<h5>Loaded " + dataSize + " rows</h5>" +
            "<h5>" + previewSize + " preview rows are shown</h5>";
        showSimpleToast(html);
        document.getElementById('downloadTrainFilesButton').disabled = false;
    }

    function onTestingDataPrepared(dataSize) {
        const previewSize = onPreviewTestingData();
        const html =
            "<h5>Loaded " + dataSize + " rows</h5>" +
            "<h5>" + previewSize + " preview rows are shown</h5>";
        showSimpleToast(html);
        document.getElementById('downloadTestFilesButton').disabled = false;
    }

    function onClearFileData(input, output) {
        input.removeAttribute('data-size');
        input.classList.remove('active');
        input.innerHTML = "Browse Input File";
        output.removeAttribute('data-size');
        output.classList.remove('active');
        output.innerHTML = "Browse Output File";
    }

    function clearTrainPreviewTable() {
        document.getElementById('trainPreviewThead').innerHTML = "";
        document.getElementById('trainPreviewTbody').innerHTML = "";
        document.getElementById('downloadTrainFilesButton').disabled = true;
    }

    function clearTestPreviewTable() {
        document.getElementById('testPreviewThead').innerHTML = "";
        document.getElementById('testPreviewTbody').innerHTML = "";
        document.getElementById('downloadTestFilesButton').disabled = true;
    }

    function onClearTrainingData() {
        const input = document.getElementById('inputTrainingDataButton');
        const output = document.getElementById('outputTrainingDataButton');
        onClearFileData(input, output);
        clearTrainPreviewTable();
        network.clearTrainingData();
    }

    function onClearTestingData() {
        const input = document.getElementById('inputTestingDataButton');
        const output = document.getElementById('outputTestingDataButton');
        onClearFileData(input, output);
        clearTestPreviewTable();
        network.clearTestingData();
    }

    function onPreviewTrainingData() {
        clearTrainPreviewTable()

        let input = network.getTrainInPreview();
        const inputSize = input.get(0).size();
        setStructureInput(inputSize);

        const headers1 = appendTableHeaders("#trainPreviewThead", inputSize, "Input");
        const cells1 = appendTableCells("#trainPreviewTbody", input);
        styleTableSelection(headers1, cells1, 'table-default');

        let output = network.getTrainOutPreview();
        const outputSize = output.get(0).size();
        setStructureOutput(outputSize);

        const headers2 = appendTableHeaders("#trainPreviewThead", outputSize, "Output");
        const cells2 = appendTableCells("#trainPreviewTbody", output);
        styleTableSelection(headers2, cells2, 'table-secondary');

        return input.size();
    }

    function onPreviewTestingData() {
        clearTestPreviewTable()

        let input = network.getTestInPreview();
        const headers1 = appendTableHeaders("#testPreviewThead", input.get(0).size(), "Input");
        const cells1 = appendTableCells("#testPreviewTbody", input);
        styleTableSelection(headers1, cells1, 'table-default');

        let output = network.getTestOutPreview();
        const headers2 = appendTableHeaders("#testPreviewThead", output.get(0).size(), "Output");
        const cells2 = appendTableCells("#testPreviewTbody", output);
        styleTableSelection(headers2, cells2, 'table-secondary');

        return input.size();
    }

    async function loadTrainDataset(dataset) {
        try {
            const input = await readCSV("datasets/" + dataset + "/train_in.csv");
            const output = await readCSV("datasets/" + dataset + "/train_out.csv");
            network.setInputTrainingData(dataset + " train input", input);
            network.setOutputTrainingData(dataset + " train output", output);
            network.prepareTrainingData();
        } catch (error) {
            console.error('Error in loadTrainDataset:', error);
        }
    }

    async function loadTestDataset(dataset) {
        try {
            const input = await readCSV("datasets/" + dataset + "/test_in.csv");
            const output = await readCSV("datasets/" + dataset + "/test_out.csv");
            network.setInputTestingData(dataset + " test input", input);
            network.setOutputTestingData(dataset + " test output", output);
            network.prepareTestingData();
        } catch (error) {
            console.error('Error in loadTestDataset:', error);
        }
    }
</script>