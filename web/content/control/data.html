<script>
    let trainInputTableObject = {headers: [], data: []};
    let trainOutputTableObject = {headers: [], data: []};
    let testInputTableObject = {headers: [], data: []};
    let testOutputTableObject = {headers: [], data: []};

    async function handleTableObjectUpload(fileInput, headersAlt) {
        return await handleTextFileUpload(fileInput)
            .then(csvToArrArr)
            .then((arrArr) => arrArrToTableObject(arrArr, headersAlt));
    }

    async function handleTableObjectPath(filepath, headersAlt) {
        return await readTextFilePath(filepath)
            .then(csvToArrArr)
            .then((arrArr) => arrArrToTableObject(arrArr, headersAlt));
    }

    function activateFileInputButton(btn, name, size) {
        btn.innerHTML = name + "<br>" + "Valid Rows: " + size;
        btn.classList.add('active');
    }

    function deactivateFileInputButton(btn, name) {
        btn.innerHTML = name;
        btn.classList.remove('active');
    }
</script>
<div class="row">
    <div class="col">
        <div class="btn-group mt-2" role="group">
            <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false">Use Dataset
            </button>
            <ul class="dropdown-menu">
                <li>
                    <button class="dropdown-item" onclick="handleLoadDataset('xor')">
                        XOR Dataset
                    </button>
                    <button class="dropdown-item" onclick="handleLoadDataset('mobile')">
                        Mobile Prices Dataset
                    </button>
                </li>
            </ul>
        </div>
        <script>
            async function handleLoadDataset(dataset) {
                trainInputTableObject = await handleTableObjectPath("datasets/" + dataset + "/train_in.csv", "Input");
                trainOutputTableObject = await handleTableObjectPath("datasets/" + dataset + "/train_out.csv", "Output");
                testInputTableObject = await handleTableObjectPath("datasets/" + dataset + "/test_in.csv", "Input");
                testOutputTableObject = await handleTableObjectPath("datasets/" + dataset + "/test_out.csv", "Output");
                network.setTrainInput(toVecVecNum(trainInputTableObject.data));
                network.setTrainOutput(toVecVecNum(trainOutputTableObject.data));
                network.setTestInput(toVecVecNum(testInputTableObject.data));
                network.setTestOutput(toVecVecNum(testOutputTableObject.data));
            }
        </script>
    </div>
</div>
<hr>
<div class="row">
    <div class="col">
        <h5>Training Data</h5>
        <input type="file" id="trainInputFileInput" accept=".csv" style="display: none"
               onchange="handleTrainInputUpload(this)">
        <div class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-light" id="trainInputFileButton"
                    onclick="document.getElementById('trainInputFileInput').click()">Browse Input File
            </button>
            <button type="button" class="btn btn-light" id="trainInputClearButton"
                    disabled onclick="handleTrainInputClear()">Clear
            </button>
            <button type="button" class="btn btn-light" id="trainInputDownloadButton"
                    disabled onclick="handleTrainInputDownload()">Download
            </button>
        </div>
        <script>
            async function handleTrainInputUpload(fileInput) {
                trainInputTableObject = await handleTableObjectUpload(fileInput, "Input");
                network.setTrainInput(toVecVecNum(trainInputTableObject.data));
            }

            function onTrainInputSet() {
                const btn = document.getElementById('trainInputFileButton');
                activateFileInputButton(btn, "Train Input Loaded", trainInputTableObject.data.length);
                document.getElementById('trainInputClearButton').disabled = false;
                document.getElementById('trainInputDownloadButton').disabled = false;
                setInputHeight(trainInputTableObject.data[0].length);
                previewTrainTable();
            }

            function handleTrainInputClear() {
                network.clearTrainInput();
            }

            function onTrainInputCleared() {
                trainInputTableObject = {headers: [], data: []};
                const btn = document.getElementById('trainInputFileButton');
                deactivateFileInputButton(btn, "Browse Input File");
                document.getElementById('trainInputClearButton').disabled = true;
                document.getElementById('trainInputDownloadButton').disabled = true;
                previewTrainTable();
            }

            function handleTrainInputDownload() {
                const arrArr = tableObjectToArrArr(trainInputTableObject);
                const csvString = arrArrToCsv(arrArr);
                downloadCSV(csvString, "train_input.csv");
            }
        </script>
        <input type="file" id="trainOutputFileInput" accept=".csv" style="display: none"
               onchange="handleTrainOutputUpload(this)">
        <div class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-light" id="trainOutputFileButton"
                    onclick="document.getElementById('trainOutputFileInput').click()">Browse Output File
            </button>
            <button type="button" class="btn btn-light" id="trainOutputClearButton"
                    disabled onclick="handleTrainOutputClear()">Clear
            </button>
            <button type="button" class="btn btn-light" id="trainOutputDownloadButton"
                    disabled onclick="handleTrainOutputDownload()">Download
            </button>
        </div>
        <script>
            async function handleTrainOutputUpload(fileInput) {
                trainOutputTableObject = await handleTableObjectUpload(fileInput, "Output");
                network.setTrainOutput(toVecVecNum(trainOutputTableObject.data));
            }

            function onTrainOutputSet() {
                const btn = document.getElementById('trainOutputFileButton');
                activateFileInputButton(btn, "Train Output Loaded", trainOutputTableObject.data.length);
                document.getElementById('trainOutputClearButton').disabled = false;
                document.getElementById('trainOutputDownloadButton').disabled = false;
                setOutputHeight(trainOutputTableObject.data[0].length);
                previewTrainTable();
            }

            function handleTrainOutputClear() {
                network.clearTrainOutput();
            }

            function onTrainOutputCleared() {
                trainOutputTableObject = {headers: [], data: []};
                const btn = document.getElementById('trainOutputFileButton');
                deactivateFileInputButton(btn, "Browse Output File");
                document.getElementById('trainOutputClearButton').disabled = true;
                document.getElementById('trainOutputDownloadButton').disabled = true;
                previewTrainTable();
            }

            function handleTrainOutputDownload() {
                const arrArr = tableObjectToArrArr(trainOutputTableObject);
                const csvString = arrArrToCsv(arrArr);
                downloadCSV(csvString, "train_output.csv");
            }
        </script>
        <div class="row justify-content-center mt-3">
            <div class="col table-responsive">
                <table class="table table-bordered">
                    <thead id="trainPreviewThead"></thead>
                    <tbody id="trainPreviewTbody"></tbody>
                </table>
            </div>
        </div>
        <script>
            function previewTrainTable() {
                document.getElementById('trainPreviewThead').innerHTML = '';
                document.getElementById('trainPreviewTbody').innerHTML = '';

                const inputArrArr = sampleArrArr(trainInputTableObject.data);
                const outputArrArr = sampleArrArr(trainOutputTableObject.data);

                const h1 = appendTableHeaders("#trainPreviewThead", trainInputTableObject.headers);
                const b1 = appendTableCells("#trainPreviewTbody", inputArrArr);
                styleTableSelection(h1, b1, 'table-default');

                const h2 = appendTableHeaders("#trainPreviewThead", trainOutputTableObject.headers);
                const b2 = appendTableCells("#trainPreviewTbody", outputArrArr);
                styleTableSelection(h2, b2, 'table-secondary');
            }
        </script>
    </div>
    <div class="col">
        <h5>Testing Data</h5>
        <input type="file" id="testInputFileInput" accept=".csv" style="display: none"
               onchange="handleTestInputUpload(this)">
        <div class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-light" id="testInputFileButton"
                    onclick="document.getElementById('testInputFileInput').click()">Browse Input File
            </button>
            <button type="button" class="btn btn-light" id="testInputClearButton"
                    disabled onclick="handleTestInputClear()">Clear
            </button>
            <button type="button" class="btn btn-light" id="testInputDownloadButton"
                    disabled onclick="handleTestInputDownload()">Download
            </button>
        </div>
        <script>
            async function handleTestInputUpload(fileInput) {
                testInputTableObject = await handleTableObjectUpload(fileInput, "Input");
                network.setTestInput(toVecVecNum(testInputTableObject.data));
            }

            function onTestInputSet() {
                const btn = document.getElementById('testInputFileButton');
                activateFileInputButton(btn, "Test Input Loaded", testInputTableObject.data.length);
                document.getElementById('testInputClearButton').disabled = false;
                document.getElementById('testInputDownloadButton').disabled = false;
                previewTestTable();
            }

            function handleTestInputClear() {
                network.clearTestInput();
            }

            function onTestInputCleared() {
                testInputTableObject = {headers: [], data: []};
                const btn = document.getElementById('testInputFileButton');
                deactivateFileInputButton(btn, "Browse Input File");
                document.getElementById('testInputClearButton').disabled = true;
                document.getElementById('testInputDownloadButton').disabled = true;
                previewTestTable();
            }

            function handleTestInputDownload() {
                const arrArr = tableObjectToArrArr(testInputTableObject);
                const csvString = arrArrToCsv(arrArr);
                downloadCSV(csvString, "test_input.csv");
            }
        </script>
        <input type="file" id="testOutputFileInput" accept=".csv" style="display: none"
               onchange="handleTestOutputUpload(this)">
        <div class="btn-group-vertical" role="group">
            <button type="button" class="btn btn-light" id="testOutputFileButton"
                    onclick="document.getElementById('testOutputFileInput').click()">Browse Output File
            </button>
            <button type="button" class="btn btn-light" id="testOutputClearButton"
                    disabled onclick="handleTestOutputClear()">Clear
            </button>
            <button type="button" class="btn btn-light" id="testOutputDownloadButton"
                    disabled onclick="handleTestOutputDownload()">Download
            </button>
        </div>
        <script>
            async function handleTestOutputUpload(fileInput) {
                testOutputTableObject = await handleTableObjectUpload(fileInput, "Output");
                network.setTestOutput(toVecVecNum(testOutputTableObject.data));
            }

            function onTestOutputSet() {
                const btn = document.getElementById('testOutputFileButton');
                activateFileInputButton(btn, "Test Output Loaded", testOutputTableObject.data.length);
                document.getElementById('testOutputClearButton').disabled = false;
                document.getElementById('testOutputDownloadButton').disabled = false;
                previewTestTable();
            }

            function handleTestOutputClear() {
                network.clearTestOutput();
            }

            function onTestOutputCleared() {
                testOutputTableObject = {headers: [], data: []};
                const btn = document.getElementById('testOutputFileButton');
                deactivateFileInputButton(btn, "Browse Output File");
                document.getElementById('testOutputClearButton').disabled = true;
                document.getElementById('testOutputDownloadButton').disabled = true;
                previewTestTable();
            }

            function handleTestOutputDownload() {
                const arrArr = tableObjectToArrArr(testOutputTableObject);
                const csvString = arrArrToCsv(arrArr);
                downloadCSV(csvString, "test_output.csv");
            }
        </script>
        <div class="row justify-content-center mt-3">
            <div class="col table-responsive">
                <table class="table table-bordered">
                    <thead id="testPreviewThead"></thead>
                    <tbody id="testPreviewTbody"></tbody>
                </table>
            </div>
        </div>
        <script>
            function previewTestTable() {
                document.getElementById('testPreviewThead').innerHTML = '';
                document.getElementById('testPreviewTbody').innerHTML = '';

                const inputArrArr = sampleArrArr(testInputTableObject.data);
                const outputArrArr = sampleArrArr(testOutputTableObject.data);

                const h1 = appendTableHeaders("#testPreviewThead", testInputTableObject.headers);
                const b1 = appendTableCells("#testPreviewTbody", inputArrArr);
                styleTableSelection(h1, b1, 'table-default');

                const h2 = appendTableHeaders("#testPreviewThead", testOutputTableObject.headers);
                const b2 = appendTableCells("#testPreviewTbody", outputArrArr);
                styleTableSelection(h2, b2, 'table-secondary');
            }
        </script>
    </div>
</div>