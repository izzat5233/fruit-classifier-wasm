<script>
    let predictionsTableObject = {headers: [], data: []};
</script>
<div class="row justify-content-center">
    <div class="col-12 d-flex flex-column flex-md-row gap-2 justify-content-center align-items-center">
        <div class="btn-group-vertical btn-group-sm mb-2 mb-md-0" role="group" aria-label="Get Outputs">
            <button type="button" class="btn btn-lg btn-primary fs-5" onclick="handleGetPredictions()">Get Predictions
            </button>
            <button type="button" class="btn btn-lg btn-outline-primary bi bi-x-lg fs-5" id="clearOutputsButton"
                    onclick="handleClearPredictions()">Clear
            </button>
        </div>
        <div class="btn-group-vertical btn-group-sm" role="group" aria-label="Download Data">
            <button type="button" class="btn btn-lg btn-outline-primary bi bi-download fs-5"
                    id="downloadWeightsButton" onclick="handleDownloadNetworkData()"> Download Network Data
            </button>
            <button type="button" class="btn btn-lg btn-outline-primary bi bi-download fs-5" disabled
                    id="downloadOutputsButton" onclick="handleDownloadPredictions()"> Download Predictions
            </button>
        </div>
    </div>
</div>
<hr class="my-4">
<div class="container">
    <div class="row justify-content-center">
        <div class="col table-responsive">
            <table class="table table-bordered">
                <thead id="predictedThead"></thead>
                <tbody id="predictedTbody"></tbody>
            </table>
        </div>
    </div>
</div>
<script>
    function handleClearPredictions() {
        predictionsTableObject = {headers: [], data: []};
        document.getElementById('predictedThead').innerHTML = "";
        document.getElementById('predictedTbody').innerHTML = "";
        document.getElementById("downloadOutputsButton").disabled = true;
    }

    function handleGetPredictions() {
        handleClearPredictions();
        document.getElementById("downloadOutputsButton").disabled = false;

        predictionsTableObject.data = toArrArr(network.getPredictions());
        predictionsTableObject.headers = testOutputTableObject.headers;

        const thead = "#predictedThead";
        const tbody = "#predictedTbody";

        const h1 = appendTableHeaders(thead, testInputTableObject.headers);
        const b1 = appendTableCells(tbody, testInputTableObject.data);
        styleTableSelection(h1, b1, 'table-default');

        const h2 = appendTableHeaders(thead, testOutputTableObject.headers);
        const b2 = appendTableCells(tbody, testOutputTableObject.data);
        styleTableSelection(h2, b2, 'table-secondary');

        const h3 = appendTableHeaders(thead, predictionsTableObject.headers);
        const b3 = appendTableCells(tbody, predictionsTableObject.data);
        styleTableSelection(h3, b3, 'table-primary');
    }

    function handleDownloadPredictions() {
        downloadCSV(arrArrToCsv(tableObjectToArrArr(predictionsTableObject)), "predictions.csv");
    }

    function handleDownloadNetworkData() {
        downloadJson({
            weights: toArrArrArr(network.getWeights()),
            biases: toArrArr(network.getBiases())
        }, "network_data.csv");
    }
</script>