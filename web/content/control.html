<div id="controlAccordion" class="accordion py-5">
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button lead fs-4" type="button" data-bs-toggle="collapse"
                    data-bs-target="#controlCollapseOne" aria-expanded="false" aria-controls="controlCollapseOne">
                Load Your Data
            </button>
        </h2>
        <div id="controlCollapseOne" class="accordion-collapse collapse show" data-bs-parent="#controlAccordion">
            <div class="accordion-body py-5">
                <div class="row">
                    <div class="col">
                        <h5>Training Data</h5>
                        <div class="btn-group">
                            <p class="btn btn-light" id="inputTrainingDataButton"
                               onclick="network.promptInputTrainingData()">Browse Input File</p>
                            <p class="btn btn-light" id="outputTrainingDataButton"
                               onclick="network.promptOutputTrainingData()">Browse Output File</p>
                        </div>
                        <div class="d-inline-block">
                            <p class="btn btn-primary px-2" id="prepareTrainingDataButton"
                               onclick="network.prepareTrainingData()">Load</p>
                            <p class="btn btn-danger px-2" id="clearTrainingDataButton"
                               onclick="onClearTrainingData()">Clear</p>
                        </div>
                        <div class="row">
                            <table class="col table table-bordered">
                                <thead id="trainInPreviewThead"></thead>
                                <tbody id="trainInPreviewTbody"></tbody>
                            </table>
                            <table class="col table table-bordered">
                                <thead id="trainOutPreviewThead"></thead>
                                <tbody id="trainOutPreviewTbody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col">
                        <h5>Testing Data</h5>
                        <div class="btn-group">
                            <p class="btn btn-light" id="inputTestingDataButton"
                               onclick="network.promptInputTestingData()">Browse Input File</p>
                            <p class="btn btn-light" id="outputTestingDataButton"
                               onclick="network.promptOutputTestingData()">Browse Output File</p>
                        </div>
                        <div class="d-inline-block">
                            <p class="btn btn-primary px-2" id="prepareTestingDataButton"
                               onclick="network.prepareTestingData()">Load</p>
                            <p class="btn btn-danger px-2" id="clearTestingDataButton"
                               onclick="onClearTestingData()">Clear</p>
                        </div>
                        <div class="row">
                            <table class="col table table-bordered">
                                <thead id="testInPreviewThead"></thead>
                                <tbody id="testInPreviewTbody"></tbody>
                            </table>
                            <table class="col table table-bordered">
                                <thead id="testOutPreviewThead"></thead>
                                <tbody id="testOutPreviewTbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <script src="js/table.js"></script>
                <script>
                    function onDataFileSet(element, filename, dataSize) {
                        element.setAttribute('data-size', dataSize);
                        element.innerHTML = filename + "<br>" + "Valid Rows: " + Number(dataSize);
                        element.classList.add('active');
                    }

                    function onInputTrainingFileSet(filename, dataSize) {
                        onDataFileSet(document.getElementById('inputTrainingDataButton'), filename, dataSize);
                    }

                    function onOutputTrainingFileSet(filename, dataSize) {
                        onDataFileSet(document.getElementById('outputTrainingDataButton'), filename, dataSize);
                    }

                    function onInputTestingFileSet(filename, dataSize) {
                        onDataFileSet(document.getElementById('inputTestingDataButton'), filename, dataSize);
                    }

                    function onOutputTestingFileSet(filename, dataSize) {
                        onDataFileSet(document.getElementById('outputTestingDataButton'), filename, dataSize);
                    }

                    function onTrainingDataPrepared(dataSize) {
                        const previewSize = onPreviewTrainingData();
                        const html =
                            "<h5>Loaded " + dataSize + " rows</h5>" +
                            "<h5>" + previewSize + " preview rows are shown</h5>";
                        showSimpleToast(html);
                    }

                    function onTestingDataPrepared(dataSize) {
                        const previewSize = onPreviewTestingData();
                        const html =
                            "<h5>Loaded " + dataSize + " rows</h5>" +
                            "<h5>" + previewSize + " preview rows are shown</h5>";
                        showSimpleToast(html);
                    }

                    function onClearFileData(input, output) {
                        input.removeAttribute('data-size');
                        input.classList.remove('active');
                        input.innerHTML = "Browse Input File";
                        output.removeAttribute('data-size');
                        output.classList.remove('active');
                        output.innerHTML = "Browse Output File";
                    }

                    function clearTrainPreviewTable() {
                        document.getElementById('trainInPreviewThead').innerHTML = "";
                        document.getElementById('trainInPreviewTbody').innerHTML = "";
                        document.getElementById('trainOutPreviewThead').innerHTML = "";
                        document.getElementById('trainOutPreviewTbody').innerHTML = "";
                    }

                    function clearTestPreviewTable() {
                        document.getElementById('testInPreviewThead').innerHTML = "";
                        document.getElementById('testInPreviewTbody').innerHTML = "";
                        document.getElementById('testOutPreviewThead').innerHTML = "";
                        document.getElementById('testOutPreviewTbody').innerHTML = "";
                    }

                    function onClearTrainingData() {
                        const input = document.getElementById('inputTrainingDataButton');
                        const output = document.getElementById('outputTrainingDataButton');
                        onClearFileData(input, output);
                        clearTrainPreviewTable()
                    }

                    function onClearTestingData() {
                        const input = document.getElementById('inputTestingDataButton');
                        const output = document.getElementById('outputTestingDataButton');
                        onClearFileData(input, output);
                        clearTestPreviewTable()
                    }

                    function onPreviewTrainingData() {
                        clearTrainPreviewTable()
                        let input = network.getTrainInPreview();
                        setupTableHeader("#trainInPreviewThead", input.get(0).size(), "Input");
                        fillNumTable("#trainInPreviewTbody", input);
                        let output = network.getTrainOutPreview();
                        setupTableHeader("#trainOutPreviewThead", output.get(0).size(), "Output");
                        fillNumTable("#trainOutPreviewTbody", output);
                        return input.size();
                    }

                    function onPreviewTestingData() {
                        clearTestPreviewTable()
                        let input = network.getTestInPreview();
                        setupTableHeader("#testInPreviewThead", input.get(0).size(), "Input");
                        fillNumTable("#testInPreviewTbody", input);
                        let output = network.getTestOutPreview();
                        setupTableHeader("#testOutPreviewThead", output.get(0).size(), "Output");
                        fillNumTable("#testOutPreviewTbody", output);
                        return input.size();
                    }
                </script>
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed lead fs-4" type="button" data-bs-toggle="collapse"
                    data-bs-target="#controlCollapseTwo" aria-expanded="false" aria-controls="controlCollapseTwo">
                Train It
            </button>
        </h2>
        <div id="controlCollapseTwo" class="accordion-collapse collapse" data-bs-parent="#controlAccordion">
            <div class="accordion-body py-5">
                <div class="row justify-content-center">
                    <div class="col">
                        <h5 class="py-4">Epochs:</h5>
                        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                            <input type="radio" class="btn-check" name="epochsRadio" id="epochsRadio1"
                                   autocomplete="off" value="1" checked>
                            <label class="btn btn-light fs-5" for="epochsRadio1">1</label>
                            <input type="radio" class="btn-check" name="epochsRadio" id="epochsRadio5"
                                   autocomplete="off" value="5">
                            <label class="btn btn-light fs-5" for="epochsRadio5">5</label>
                            <input type="radio" class="btn-check" name="epochsRadio" id="epochsRadio10"
                                   autocomplete="off" value="10">
                            <label class="btn btn-light fs-5" for="epochsRadio10">10</label>
                            <input type="radio" class="btn-check" name="epochsRadio" id="epochsRadio50"
                                   autocomplete="off" value="50">
                            <label class="btn btn-light fs-5" for="epochsRadio50">50</label>
                            <input type="radio" class="btn-check" name="epochsRadio" id="epochsRadio100"
                                   autocomplete="off" value="100">
                            <label class="btn btn-light fs-5" for="epochsRadio100">100</label>
                            <button type="button" title="start" id="startTrainingButton" onclick="startTraining()"
                                    class="btn btn-lg btn-success bi bi-play-fill fs-5"></button>
                        </div>
                        <div>
                            <h5 class="py-4">Options:</h5>
                            <div class="px-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="useTestDataCheck">
                                    <label class="form-check-label" for="useTestDataCheck">
                                        Use Testing Data
                                    </label>
                                </div>
                            </div>
                        </div>
                        <hr class="my-4">
                        <div>
                            <button type="button" title="start" id="refreshWeightsButton" onclick="network.build()"
                                    class="btn btn-lg btn-danger bi bi-arrow-clockwise fs-5"> Randomize Weights
                            </button>
                        </div>
                    </div>
                    <div class="col">
                        <h5 class="py-4">Training Errors:</h5>
                        <div id="trainingLogger"></div>
                    </div>
                    <div class="col">
                        <h5 class="py-4">Testing Errors:</h5>
                        <div id="testingLogger"></div>
                    </div>
                </div>
                <script>
                    function startTraining() {
                        const trainLogger = document.getElementById('trainingLogger');
                        const testLogger = document.getElementById('testingLogger');
                        trainLogger.innerHTML = "";
                        testLogger.innerHTML = "";

                        const epochs = getSelectedEpochValue();
                        let res;
                        if (document.getElementById('useTestDataCheck').checked) {
                            res = network.trainAndTestFor(epochs);
                            for (let i = 0; i < res.size(); ++i) {
                                trainLogger.innerHTML += "<p>" + res.get(i).get(0) + "</p>";
                                testLogger.innerHTML += "<p>" + res.get(i).get(1) + "</p>";
                            }
                        } else {
                            res = network.trainFor(epochs);
                            for (let i = 0; i < res.size(); ++i) {
                                trainLogger.innerHTML += "<p>" + res.get(i) + "</p>";
                            }
                        }
                    }

                    function getSelectedEpochValue() {
                        const radioButtons = document.querySelectorAll('input[name="epochsRadio"]');
                        for (const radioButton of radioButtons) {
                            if (radioButton.checked) {
                                return Number(radioButton.value);
                            }
                        }
                    }
                </script>
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed lead fs-4" type="button" data-bs-toggle="collapse"
                    data-bs-target="#controlCollapseThree" aria-expanded="false" aria-controls="controlCollapseThree">
                Test It
            </button>
        </h2>
        <div id="controlCollapseThree" class="accordion-collapse collapse" data-bs-parent="#controlAccordion">
            <div class="accordion-body">
                <div class="row gy-4">

                </div>
            </div>
        </div>
    </div>
</div>
